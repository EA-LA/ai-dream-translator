<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a1026" />
  <title>Pricing — AI Dream Translator</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg"><div class="stars"></div><div class="glow"></div></div>
  <nav class="nav"><div class="wrap nav-in">
    <a class="brand" href="index.html"><span class="logo"></span><span>AI Dream Translator</span></a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a class="active" href="pricing.html">Pricing</a>
      <a href="contact.html">Contact</a>
      <a href="signin.html" class="btn ghost">Sign in</a>
      <a href="signin.html#signup" class="btn primary">Get started</a>
    </div>
  </div></nav>

  <header class="wrap hero center">
    <h1 class="h1">Simple, fair pricing</h1>
    <p class="lead">Start free. Upgrade when you want unlimited interpretations and dream art.</p>
    <p id="payMsg" class="small"></p>
  </header>

  <main class="wrap">
    <div class="price-grid">
      <section class="card price-card">
        <h3>Free</h3>
        <div class="price">$0</div>
        <p class="small">Great to try it out</p>
        <div class="mt">
          <div class="li"><span class="dot"></span> 2 interpretations/day</div>
          <div class="li"><span class="dot"></span> Demo dream art</div>
          <div class="li"><span class="dot"></span> Basic tips</div>
        </div>
        <div class="mt2"><a class="btn ghost" href="signin.html#signup">Get started</a></div>
      </section>

      <section class="card price-card" style="border-color:rgba(122,168,255,.45)">
        <h3>Pro</h3>
        <div class="price">$5.99<span class="small">/mo</span></div>
        <p class="small">Most popular</p>
        <div class="mt">
          <div class="li"><span class="dot"></span> Unlimited interpretations</div>
          <div class="li"><span class="dot"></span> HD dream art</div>
          <div class="li"><span class="dot"></span> Dream history & search</div>
          <div class="li"><span class="dot"></span> Priority support</div>
        </div>
        <div class="mt2"><button class="btn primary" id="btnProMonthly">Upgrade</button></div>
      </section>

      <section class="card price-card">
        <h3>Pro+</h3>
        <div class="price">$49<span class="small">/yr</span></div>
        <p class="small">2 months free</p>
        <div class="mt">
          <div class="li"><span class="dot"></span> Everything in Pro</div>
          <div class="li"><span class="dot"></span> Yearly insights report</div>
          <div class="li"><span class="dot"></span> Early access features</div>
        </div>
        <div class="mt2"><button class="btn ghost" id="btnProYearly">Go yearly</button></div>
      </section>
    </div>
  </main>

  <footer class="wrap foot">© <span id="year"></span> AI Dream Translator</footer>

  <!-- Firebase (to check login state only) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBjoLNuLEFwEZURiZAj_O3q-YXu4kug2eM",
      authDomain: "ai-dream-translator.firebaseapp.com",
      projectId: "ai-dream-translator",
      storageBucket: "ai-dream-translator.firebasestorage.app",
      messagingSenderId: "684674852759",
      appId: "1:684674852759:web:732de7d510e70187de06d2",
      measurementId: "G-CPZLDSPPGK"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const payMsg = document.getElementById('payMsg');
    const btnMonthly = document.getElementById('btnProMonthly');
    const btnYearly  = document.getElementById('btnProYearly');

    function requireLoginThen(action){
      onAuthStateChanged(auth, (user) => {
        if (!user) { window.location.href = "signin.html?next=pricing.html"; }
        else { action(user); }
      });
    }

    async function startCheckout({ yearly = false, user }){
      try{
        payMsg.textContent = "Creating secure checkout…";
        const r = await fetch("/api/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            priceId: yearly ? "YEARLY" : null,
            email: user?.email || null,
            successUrl: `${window.location.origin}/success.html`,
            cancelUrl: `${window.location.origin}/pricing.html`
          })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || "Checkout failed");
        window.location.href = data.url;
      } catch (e) {
        payMsg.textContent = e.message || "Could not start checkout.";
      }
    }

    btnMonthly?.addEventListener("click", () => {
      requireLoginThen((user) => startCheckout({ yearly:false, user }));
    });
    btnYearly?.addEventListener("click", () => {
      requireLoginThen((user) => startCheckout({ yearly:true, user }));
    });
  </script>

  <script src="app.js" defer></script>
</body>
</html>
